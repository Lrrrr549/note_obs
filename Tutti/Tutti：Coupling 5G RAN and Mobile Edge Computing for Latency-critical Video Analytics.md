# Abstract

移动边缘计算：5G生态关键组成部分，将服务器部署在靠近最终用户的地方，类比章鱼——大脑+触手。

延迟：5G与MEC不协调，产生长响应延迟。

Tutti：将5G RAN与MEC耦合（couple）在用户空间，确保延迟关键视频分析（latency-critical video）的性能。Tutti通过融合5G RAN的瞬时无线动态和边缘服务器的应用层内容变化，做到了精确定制应用服务需求。然后，Tutti通过5G RAN与边缘服务器间的实时交互，为应用程序强制提供资源。

结果：响应延迟降低了61.69%，交互成本可忽略。
# 1. Introduction

​5G的兴起带来了很多产业的变化，同时带来了大量的带宽和计算资源需求，也产生了低延迟的需求。

Tutti将5G RAN和MEC耦合在一起，满足延迟敏感型应用的需求。核心思想是，将边缘服务器的应用层信息与5G RAN的物理链路动态相结合，再以此为基础定制每一帧的需求。例如，当边缘服务器发现某一帧已经要接近ddl，服务器会督促基站（BS，Base Station）优先分配资源。5G运营商也在采用网络切片（network slicing）划分专用的资源。Tutti就定位在网络切片中。

Tutti的two unique challenges：
1. 如何准确理解应用的需求？
	困难之处：一方面，视频分析的应用层内容会不断变化；另一方面。无线信道在帧传输的过程中是时变的，难以预测的。如果不能解决这两方面的问题，将导致：过度分配降低资源利用率和低估用量影响服务质量（QoE）两个相反的问题。而Tutti可以感知到丰富的跨层信息，这样就引出了一种定制应用需求的预测方法。即，Tutti采用上下文感知回归学习算法来预测应用层内容的变化，使用概率似然模型来估计无线动态；随后Tutti将这两种算法融合成一个精确的应用需求规则。

2. 如何可靠地执行对截止日期敏感的资源供应？
	Tutti学习到应用程序的需求，其可靠执行将依赖于RAN的物理/介质访问控制层资源分配。一种简介的 方式是，基站强制提前预留足够的资源，当用户设备（UE）请求时分配下去。但是这种方式需要对蜂窝标准栈（the cellular standard stack）和基础设施进行重构，会产生高昂的成本。

​于是，文章提出了一种对期限敏感的资源分配方法（Deadline-Sensitive），促进边缘服务器与5G RAN之间的轻量级交互，保证资源的及时授予，根据奖励和加速机制灵活确定资源分配的优先级。Tutti存在激励机制，鼓励在时间充足时提供资源，如果ddl将近，则确立新的优先级，加速提供。​

PRB（Physical Resource Block，物理资源块）Tutti预测间隔为Microscope的五分之一，资源供应效率接近于Oracle上界，只有一个供应回合差距。存在部分可忽略的开销。

贡献：Tutti是第一个用户空间LTE/5G RAN和MEC耦合框架，并在real world进行部署与评估。现场测量研究揭示了现有5G MEC中松散耦合导致的低用户体验质量；设计了Tutti—>轻量级、标准兼容—>预测应用需求并保证资源供应；在虚拟的蜂窝MEC平台上对Tutti进行原型设计。
# 2. Motivation（动机）

​![[Pasted image 20231023220827.png]]​

5G User -> shoots -> 5G BS -> Edge Servers -> infer objects -> 5G BS -> User

帧响应延迟（frame response latency）和每个快照的感知精度是视频分析的关键QoE指标。
## 2.1. Measurement Methodology

5G RAN与边缘服务。在5G MEC系统中，边缘服务器集群通常部署在5G RAN的背面，涉及大量分布式基站。实验的设备：5G RAN：sub-6 GHz（3.5 GHz频率，NSA架构下的100 MHz频段）；边缘服务器：V100 32GB、Intel I9、8 cores。

​![[Pasted image 20231023220905.png]]​

表1，

延迟关键视频分析。分两类，一类对延迟敏感，具有即时改变的特性，如目标检测、目标追踪和实例分割等；另一类对延迟并不具有高敏感性，如环境检测、车牌、人脸识别、物体计数等。文章关注第一类。

即时性，有两种实现方法：
	（1）设备全部放在一个“box”里，比如把摄像机等模块都放在汽车里，固然延迟较短，但消耗成本；
	（2）Figure 1中边缘辅助卸载模式。

选用评估任务：OD（YOLO），OT（SiamFC），IS（Mask R-CNN）

终端和测量工具。终端：5G 安卓手机，在手机上部署帧捕捉/解码/流媒体程序。过程：终端在城市行驶的汽车上（30-110km/h），同时以每秒30帧的速度上传开源图像集到边缘服务器，并获得反馈输出；监测蜂窝行为：使用相关软件，同时编写脚本在服务器上记录QoE指标。
## 2.2. QoE of Latency-critical Video Analytics

​![[Pasted image 20231023221000.png]]​

帧响应延迟极长。Table 2，所有任务都不能满足响应延迟容忍度（200ms）。最快的OT，有44.11%的帧在200ms内到达，10.67%的情况超过400ms。响应延迟包括网络传输和计算推理，前者占据支配地位，而且传输时上行链路延迟更大。

感知准确度低。用mAP（发送帧的ground truth和推理结果）进行度量。Table 2中可以看出，相比于“all-in-box”，三个任务的感知准确率显著下降。证明5G MEC不能满足视频分析的QoE需求。
## 2.3. An In-depth Investigation of Poor QoE

发现1：性能差与5G RAN中的无线资源紧缺无关。吞吐量完全可被上行链路容量容纳。

直接原因：帧传输过程中无线资源低下的传输效率。

Figure2(a)：
	①UE向BS发送测量报告，监测无线信道质量。
	当新的数据包到达UE的缓冲区时，在②中触发SR/BSR（缓冲状态报告）消息，发送给BS。
	在③-⑨结束后，返回一个上行链路（UL）Grant信息，包括PRB配置；最后，UE缓冲区的数据被填充到PRB中，并且上传到BS。如果UE一次传输失败，将重新发送BSR消息。

​![[Pasted image 20231023221325.png]]​
​
我们将数据包到达、UL授权、数据传输和重传之间的时间分别定义为$T_{wait}$、$T_{trans}$和$T_{re-trans}$

n代帧的上传延迟表示为：
$$T_{n}=\sum^{R}_{r=1}(T^r_{wait}+T^r_{trans}+T^r_{re-trans}),1\leqslant{r}\leqslant{R}$$
r 是资源请求-授权轮次的标识符。

这种机制的不足：

1. 上行链路资源授权延迟与不足。如Figure 3所示，共50跟BSR请求（X），只有12个（●）被基站成功批准；即使UE获得了UL授权，分配的资源也不足以立即清除缓冲区数据；图中93ms定为缓冲完成，即所有数据包进入缓冲区，但有6个请求，不在93ms内，即有36.11%的帧响应延迟浪费在了缓冲区清空阶段。

​![](https://cdn.nlark.com/yuque/0/2023/png/39250676/1697854855660-8424503e-00d1-4b07-ab1f-9411645c23d0.png)​

多轮交互时资源等待延迟长。Figure 4显示，①大部分延迟用于等待UL Grant。②$T_{wait}$在多数情况下占据主导地位。

​![](https://cdn.nlark.com/yuque/0/2023/png/39250676/1697857037510-e4489ec1-c86b-49d7-a83d-1e6e3984b8f5.png)​

根本原因：5G RAN与MEC彼此透明。

1. RAN不知道视频分析的延迟关键需求，只能根据用户设备缓冲区的状态和瞬时链路的容量进行非精确的预测和服务。在文章的研究中，调度器优先满足有较大无线资源请求的用户，而忽略请求量较小的，Figure 5验证了这一点：TBS（传输块大小）与物理层比特率之间存在明显的、不正常的缺口。这种调度策略无法满足对延迟要求很高的用户的需求，这会导致这类用户继续向BS发送额外的BSR messages，直到最后得到满足。

​![](https://cdn.nlark.com/yuque/0/2023/png/39250676/1697859200675-56f52a4f-44dc-457f-bac0-7a0cd71e99d3.png)​

2. 视频分析后端，也就是边缘服务器端，由于缺乏与5G RAN之间的交互支持，无法适应随时间变化的频道动态。Fig 6和Fig 7是文章中进行的两个对比实验，分别在静态（停车）和动态（开车）场景下，对waiting delay和UE缓冲区状态进行跟踪。可以看出，动态下是静态下的1.73倍。

​![](https://cdn.nlark.com/yuque/0/2023/png/39250676/1697860207310-f8e41f89-4a41-43de-a1a5-7ec5b9822c7c.png)​

二者间的透明度降低了资源分配效率，延长了延迟。将5G RAN和MEC耦合起来，使双方知道彼此的真实需求或状态变化，保证延迟敏感的应用的QoE。

# 3. SYSTEM OVERVIEW（系统概述）

Tutti，5G RAN与MEC耦合的框架。Figure 8是Tutti的系统概览，基本流程是，UE向服务基站不断请求资源，然后获得分配的资源，最后将其数据包传递给边缘服务器进行计算。KEY：确保UE及时获得所需的资源。

与前文提到的多轮资源“请求-授权”机制相比，Tutti选用了一种不同的方法，即以轻量级用户空间后台程序的形式在边缘服务器上来保证无线资源的及时提供。

​![](https://cdn.nlark.com/yuque/0/2023/png/39250676/1697868698248-df924b51-0f72-4384-8473-b1064db4d4df.png)​

Tutti将RAN状态和应用层上下文信息（从边缘服务器获得）作为系统输入，并通过两个主要模块输出资源配置来引导基站的PRB授权。

模块Ⅰ：A cross-layer QoE demand (Dmd.)。跨层QoE需求定制方法，用于了解下一帧交付需要多少资源，具体地，通过回归学习预测应用层内容的变化，使用统计似然模型估计时变链路动态。然后，Tutti将中间结果融合到需求规则中，该规则校准所需资源的数量。

模块Ⅱ：用于动态优先发放资源的激励与加速机制，可以确保在ddl之前发放资源。e.g.，如果时间未到ddl，Tutti将会分配优先级较低的资源，否则会紧急加速资源调度与分配。为了实现这个，Tutti在资源配置消息中嵌入了授权优先指示符，同时及时与基站进行交互进行资源分配与调整。

Tutti的耦合设计带来的好处。

Ⅰ：通过了解应用层内容和物理连接的实时变化来提高视频分析的QoE，促进了RAN与边缘服务器间的交互。这样，Tutti“欺骗”了MAC层调度器，提前寻找资源容量，进行分配。

Ⅱ：Tutti位于边缘服务器端，未对网络基础设施和UE进行大量修改，是轻量级的。为5G MEC的部署提供新的视角。

# 4. CROSS-LAYER DEMAND CUSTOMIZATION（跨层需求设计）

准确理解视频分析的QoE需求存在两个重要的关联因素：

1. 应用层内容在多样的场景中随机变化。Table 3显示了在不同场景下测量的帧大小。繁忙街道场景下平均大小更高，标准差也显示在复杂场景下差异更高。

​![](https://cdn.nlark.com/yuque/0/2023/png/39250676/1697873911341-ca6f2913-5c9e-4442-90d1-07a3343327a0.png)​

2. 由于信号波动、衰减损耗和用户移动，无线信道是时变的。随频带的增加，5G比LTE存在更大的波动性。

而这两个因素是互相作用的。

Tutti通过跨层信息融合的方式应对这些因素。

Ⅰ：Tutti位于边缘服务器，可以轻松获得应用层的上下文信息，包括从用户设备发送的帧和模型推断的信息，如检测框和跟踪轨迹等。

Ⅱ：在MEC（Multi-Access Edge Computing，多接入边缘计算）标准中引入了新功能，RNIS，无线网络信息服务，可以解码物理层和网络层链接，向上层服务公开微观尺度的RAN状态。而这种详细的跨层信息反映了应用内容和无线信道的实时变化，可以帮助Tutti了解ms级粒度应用的QoE需求。

过程：

1. Tutti将应用层上下文输入到内容变化预测模块中，获取下一帧的大小。
2. 链路动态估计模块使用细粒度RAN状态来预测实时链路质量。
3. Tutti将它们融合到需求规则中，确定下一帧传输所需的资源数量。

## 4.1. Context-aware Content Changes Prediction（基于上下文的内容变化预测）

场景多样性主要受到三个因素的影响，即背景复杂性、对象元素的数量和对象的运动状态。文章中使用上下文信息通过回归算法来理解这三个因素。

Ⅰ：帧序列化。UE帧是串行上传，可以帮助Tutti理解背景复杂性的变化。

Ⅱ：对象元素的数量和运动状态可以从推断的语义信息中检测出来。

​![](https://cdn.nlark.com/yuque/0/2023/png/39250676/1698026569984-1467f5df-2c47-436b-8183-1494e8517d6d.png)​

Fig 9展示了算法的两个阶段。

1. 单帧特征提取。输入第![](https://cdn.nlark.com/yuque/__latex/2443fbcfeb7e85e1d62b6f5e4f27207e.svg)帧的帧大小![](https://cdn.nlark.com/yuque/__latex/66afb9b0e9a47ed2451038440c07e1eb.svg)、帧内容![](https://cdn.nlark.com/yuque/__latex/b905507af0398e85738013851eaba187.svg)和语义信息![](https://cdn.nlark.com/yuque/__latex/bf7d00efcf47b6c2aa1fa916a75f0857.svg)到相应的特征提取器，然后输出特征向量![](https://cdn.nlark.com/yuque/__latex/72331209062938dfa922d071aa34a25c.svg)。公式为：

​![](https://cdn.nlark.com/yuque/__latex/8bbbbc0fe29150c14a6705572d33d938.svg)​

其中，⊕﻿是串联运算，是浮点数，是三维矩阵（224,224,3），包括检测框和移动状态，![](https://cdn.nlark.com/yuque/__latex/c9b8f7518d5ffd93e86d2153a5271f3c.svg)和![](https://cdn.nlark.com/yuque/__latex/34feb6272126e6d9eb22148d2048fb9a.svg)是嵌入层，用来量化帧大小和对象数量/运动状态的潜在序列特征。

Tutti也使用ResNet-50![](https://cdn.nlark.com/yuque/__latex/c25b65cf26524b1f1cc9b8237c697184.svg)来获取帧本身的特征。

2. 时间特征提取阶段。
    使用GRU（门控循环单元），输入时间序列特征组来预测下一帧的大小。每个特征组将个（一般为20）历史序序列化帧的特征向量串联起来，该阶段的核心是基于GRU的特征提取器。将新特征组和过去特征组生成的旧中间结果结合，然后推断出下一个值，即$$F_{n+1}=GRU(G^{inter}_{n},\{V_{n-m+1},V_{n-m+2},...,V_{n}\})$$其中，$$G_{n}^{inter}=GRU(G^{inter}_{n-1},\{V_{n-m},V_{n-m+1},...,V_{n-1}\})$$
## 4.2 Real-time Estimation of Link Dynamics（链路动态的实时估计）

目前对链路动态的理解主要基于UE进行的channel测量。CLAW和PBE-CC，通过UE的解码通道来测量链路的带宽和拥塞窗口。但是这样存在粗粒度延迟，比如每80个时隙触发一次，最多40ms，同时信道波动也会有影响。
Tutti则选用了预测的方法，不需要等待报告。
MEC的RNIS功能可以记录SINR（信噪比）轨迹（ms），提供给Tutti用来学习。
__SINR曲线的统计分布。__ 短期SINR轨迹服从截断高斯分布，可以用统计似然方法进行预测估计；同时也选择其他RAN状态信息来对似然参数进行校准。
![[Pasted image 20231024200104.png]]
Fig 10，200ms内SINR轨迹。遵循截断高斯分布，即$SINR\sim\mathcal{N}(\mu,\sigma^2,a,b)$。$\mathcal{N}(\cdot)$是具有$(a,b)$限制的高斯分布，剩下两个分别是均值和标准差。后进行了拟合，遵循截断高斯分布的高决定系数，进一步验证，随机选择了3条SINR，使用Fig 11的拟合线绘制CDF曲线，$R^2$系数都很高，但有波动，归结为UE和BS的相对位置变化。UE、BS之间的距离与SINR成反比。高速行驶时会导致其波动剧烈，快速收敛。
预测：截断高斯似然估计方法。似然模型表述为：
$$I^{est}=\mathcal{L}(\{I_{1},\cdots,I_{i},\cdots,I_{m}\}),$$
$I^{est}$是下一时刻的SINR，$I_{i}$属于短期（200ms）历史轨迹，$\mathcal{L}(\cdot)$是似然函数。同时为了减小误差，文章设置了期望，给了上下界$\int^a_{b}$
提高精度：主要在$(a,b)$上做文章。最初设定为历史集合的上下界，但容易受到信道波动的影响。MEC的RNIS可以记忆SINR痕迹，参考这些数据对$a,b$进行微调。
## 4.3 Generating Demand Rule（生成需求规则）
了解应用层和数据链路层变化与动态后，需将帧大小$F_{n+1}$和SINR$I^{est}$融合到资源需求中$PRB^{all}_{n+1}$。

需要解决的问题：

1. 填补应用层数据与物理bit之间的差距。
	应用层主要是帧大小，物理层则是PRB的配置，二者间存在容量缺口。
	物理位容量：
	$F^{PHY}_{n+1}=\sum^{J}_{j=1}[(1-r_{j})\cdot{k_{j}}{\cdot}{s_{j}+\epsilon\cdot{s_{j}}}]+o(F_{n+1}^{ctrl})$
	$r_{j}$取值0或1，$j$代数据包成功到达取0，反之1；$k_{j}$表示$j$代报文重传次数；$\epsilon$表示协议开销，取0.068；$o(\cdot)$是控制信令占的容量。存在理想情况，所有数据包都成功到达，无重传。

2. 填充物理通道的开销与占用。
	根据3GPP 5G NR规范（Rel-15 TS 38.306），量化$PRB_{n+1}^{all}$为：
	$$PRB^{all}_{n+1}=\frac{5\cdot{10^4}}{1-OH}{\cdot}\frac{F_{n+1}^{PHY}}{M(I^{est})},$$
	$OH$是物理信道开销，$M(\cdot)$起到信道调制功能，可通过$I^{est}$进行推导。
# 5  DDL-SENSITIVE RESOURCE PROVISION（DDL敏感的资源提供）

上文决定了请求规则，则Tutti接下来要保证在DDL之前执行。
方法1：预留资源块，收到请求就及时授予。
	存在缺点：
	(1) 需要网络基础设施重构
	(2) 对其他用户不公平
Tutti采用对DDL敏感的资源供应方式，轻量级、公平共享。作为用户空间守护进程促进RAN和边缘服务器的主动交互。
![[Pasted image 20231024221455.png]]
Fig 12展示了操作流程。
获取PRB Grant状态，判断是否接近截止时间（阈值100ms）。若时间充足，执行公平的优先级调整，资源倾斜到延迟敏感型用户；如果DDL接近，采用加速机制加速分配。即，在保证应用程序生存的条件下，尽可能将资源倾斜到延迟敏感型用户。
## 5.1 Incentive and Acceleration Mechanism（激励与加速机制）

公平分配条款的激励机制。
首先定义一个度量值$\mathcal{S}_{t}$，表达在TTI传输时间间隔内，获取资源PRB分配时的满意程度。
$$\mathcal{S}_{t}=\sum_{k=1}^{K}sgn(m^k_t){\cdot}\zeta[P_{k},\Delta^k_t(PRB)],$$
$m^k_t$表示满意度，有三个值：1（分配资源大于最低生存线），0（分配资源等于最低生存线），-1（分配资源小于最低生存线）。
为延迟敏感型用户提供：$\mathcal{S}_{t}^{*}=sgn(m^k_t){\cdot}\zeta[P_{k},\Delta^k_t(PRB)]$，文章接着调整延迟关键用户的服务优先级窗口$P_{wnd}^*$来引导资源的分配。

满足DDL的加速机制。
激励机制中仍存在风险：不能确保一个frame在DDL内完全交付。如，即使$P_{wnd}^*$以线性增长，由于存在其他更高优先级的用户，延迟关键用户也可能无法首先被分配资源。所以加入了bottom-line方法来保证最后期限。
加速机制的直观概念是，当用户TTL接近DDL时，优先为用户提供资源，文章以指数增加$P_{wnd}^*$的方法来实现。
$$\large{P_{wnd}^*=e^{-(T_{k}^{ddl}-t{\cdot}TTI){\cdot}(PRB_{n+1}^{all}-\sum_{i=1}^{t}PRB^{grant}_{i})}}$$
$(T_{k}^{ddl}-t{\cdot}TTI)$表示DDL的接近程度，$(PRB_{n+1}^{all}-\sum_{i=1}^{t}PRB^{grant}_{i})$表示资源分配的状态。
## 5.2 Standard-compatible Interaction Protocol（标准兼容交互协议）

目的：方便RAN与边缘服务器间的通信。
![[Pasted image 20231025164123.png]]
如图所示，根据SDN/NFV原则将软件空间分为用户区域和控制区域，与通用的标准相兼容。